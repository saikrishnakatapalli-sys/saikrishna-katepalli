<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Global Online Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;margin:0;padding:20px;background:#f4f6ff}
.card{background:#fff;padding:20px;border-radius:10px;margin-bottom:20px}
input,textarea,select{width:100%;padding:8px;margin:5px 0}
button{padding:8px 12px;margin-top:5px;background:#0066ff;color:#fff;border:none;border-radius:6px;cursor:pointer}
button:hover{background:#004ecc}
.owner{background:#ffecec}
.order{border:1px solid #ddd;padding:10px;margin:10px 0;border-radius:6px}
</style>
</head>
<body>

<h2>Online Store</h2>

<div id="auth-section" class="card">
<h3>Login / Register</h3>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
<p id="auth-msg"></p>
</div>

<div id="store-section" hidden>

<div id="customer-view" hidden class="card">
<h3>Customer Details</h3>
<input type="text" id="name" placeholder="Full Name">
<input type="text" id="phone" placeholder="Phone">
<textarea id="address" placeholder="Address"></textarea>

<h3>Products</h3>
<div id="product-list"></div>

<h3>Place Order</h3>
<select id="product-select"></select>
<input type="number" id="quantity" placeholder="Quantity">
<button onclick="placeOrder()">Place Order</button>
</div>

<div id="owner-view" hidden class="card owner">
<h3>Owner Panel</h3>

<h4>Add Product</h4>
<input type="text" id="new-product" placeholder="Product Name">
<input type="number" id="new-price" placeholder="Price">
<button onclick="addProduct()">Add Product</button>

<h4>All Orders</h4>
<div id="all-orders"></div>
</div>

<button onclick="logout()">Logout</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, doc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

const ownerEmail = "saikrishna@gmail.com"; // change to your email

window.register = async function(){
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  try{
    await createUserWithEmailAndPassword(auth,email,password);
    document.getElementById("auth-msg").innerText="Registered!";
  }catch(e){alert(e.message);}
}

window.login = async function(){
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  try{
    await signInWithEmailAndPassword(auth,email,password);
  }catch(e){alert(e.message);}
}

window.logout = function(){ signOut(auth); }

onAuthStateChanged(auth,(user)=>{
  if(user){
    document.getElementById("auth-section").hidden=true;
    document.getElementById("store-section").hidden=false;

    if(user.email===ownerEmail){
      document.getElementById("owner-view").hidden=false;
      document.getElementById("customer-view").hidden=true;
      loadOrders();
    }else{
      document.getElementById("customer-view").hidden=false;
      document.getElementById("owner-view").hidden=true;
      loadProducts();
    }
  }else{
    document.getElementById("auth-section").hidden=false;
    document.getElementById("store-section").hidden=true;
  }
});

async function loadProducts(){
  const snapshot=await getDocs(collection(db,"products"));
  const select=document.getElementById("product-select");
  const list=document.getElementById("product-list");
  select.innerHTML="";
  list.innerHTML="";
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    select.innerHTML+=`<option value="${docSnap.id}">${data.name} - ₹${data.price}</option>`;
    list.innerHTML+=`<div>${data.name} - ₹${data.price}</div>`;
  });
}

window.addProduct = async function(){
  const name=document.getElementById("new-product").value;
  const price=document.getElementById("new-price").value;
  await addDoc(collection(db,"products"),{name,price});
  alert("Product Added");
}

window.placeOrder = async function(){
  const user=auth.currentUser;
  const productId=document.getElementById("product-select").value;
  const qty=document.getElementById("quantity").value;

  const name=document.getElementById("name").value;
  const phone=document.getElementById("phone").value;
  const address=document.getElementById("address").value;

  const productRef=doc(db,"products",productId);
  const productSnap=await getDoc(productRef);
  const productData=productSnap.data();

  await addDoc(collection(db,"orders"),{
    userEmail:user.email,
    name,
    phone,
    address,
    product:productData.name,
    price:productData.price,
    quantity:qty,
    total:productData.price*qty,
    status:"Pending",
    created:new Date()
  });

  alert("Order Placed!");
}

async function loadOrders(){
  const snapshot=await getDocs(collection(db,"orders"));
  const div=document.getElementById("all-orders");
  div.innerHTML="";
  snapshot.forEach(docSnap=>{
    const o=docSnap.data();
    div.innerHTML+=`
    <div class="order">
      <b>${o.name}</b> (${o.userEmail})<br>
      Phone: ${o.phone}<br>
      Address: ${o.address}<br>
      Product: ${o.product}<br>
      Qty: ${o.quantity}<br>
      Total: ₹${o.total}<br>
      Status: ${o.status}
    </div>`;
  });
}

</script>
</body>
</html>
