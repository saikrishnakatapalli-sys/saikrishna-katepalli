<!DOCTYPE html>
<html>
<head>
  <title>My Online Store</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .hidden { display: none; }
    .box { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    button { margin: 5px 0; }
  </style>
</head>
<body>

<h1>My Online Store</h1>

<!-- Auth Section -->
<div id="authSection">
  <h3>Login / Register</h3>
  <input id="username" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<!-- Owner Panel -->
<div id="ownerPanel" class="hidden">
  <h2>Owner Panel</h2>

  <h3>Add Product</h3>
  <input id="pname" placeholder="Product Name"><br>
  <input id="pprice" type="number" placeholder="Price"><br>
  <button onclick="addProduct()">Add Product</button>

  <h3>All Orders</h3>
  <div id="orders"></div>
</div>

<!-- Customer Panel -->
<div id="customerPanel" class="hidden">
  <h2>Products</h2>
  <div id="products"></div>

  <h3>Your Cart</h3>
  <div id="cart"></div>
  <button onclick="placeOrder()">Place Order</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentUser = null;
let cart = [];

/* ---------------- LOCAL USER SYSTEM ---------------- */

function getUsers(){
  return JSON.parse(localStorage.getItem("users") || "[]");
}

function setUsers(u){
  localStorage.setItem("users", JSON.stringify(u));
}

window.register = function(){
  const u = username.value;
  const p = password.value;
  const users = getUsers();
  users.push({u,p});
  setUsers(users);
  alert("Registered!");
}

window.login = function(){
  const u = username.value;
  const p = password.value;
  const users = getUsers();
  const found = users.find(x => x.u===u && x.p===p);
  if(!found){ alert("Invalid"); return; }

  currentUser = u;
  authSection.classList.add("hidden");

  if(u === "admin"){   // OWNER USERNAME
    ownerPanel.classList.remove("hidden");
    loadOrders();
  }else{
    customerPanel.classList.remove("hidden");
    loadProducts();
  }
}

/* ---------------- PRODUCTS (GLOBAL) ---------------- */

async function loadProducts(){
  products.innerHTML="";
  const snap = await getDocs(collection(db,"products"));
  snap.forEach(doc=>{
    const p = doc.data();
    const div = document.createElement("div");
    div.className="box";
    div.innerHTML=`
      ${p.name} - ₹${p.price}
      <button onclick="addToCart('${p.name}',${p.price})">Add</button>
    `;
    products.appendChild(div);
  });
}

window.addProduct = async function(){
  const name = pname.value;
  const price = Number(pprice.value);
  await addDoc(collection(db,"products"),{name,price});
  alert("Product Added Globally!");
}

/* ---------------- CART ---------------- */

window.addToCart = function(name,price){
  cart.push({name,price});
  renderCart();
}

function renderCart(){
  cartDiv = document.getElementById("cart");
  cartDiv.innerHTML="";
  cart.forEach((c,i)=>{
    cartDiv.innerHTML += `${c.name} - ₹${c.price}<br>`;
  });
}

/* ---------------- ORDERS (GLOBAL) ---------------- */

window.placeOrder = async function(){
  if(cart.length===0){ alert("Cart Empty"); return; }

  await addDoc(collection(db,"orders"),{
    user: currentUser,
    items: cart,
    date: new Date().toLocaleString()
  });

  alert("Order Placed!");
  cart=[];
  renderCart();
}

async function loadOrders(){
  orders.innerHTML="";
  const snap = await getDocs(collection(db,"orders"));
  snap.forEach(doc=>{
    const o = doc.data();
    const div = document.createElement("div");
    div.className="box";
    div.innerHTML=`
      <b>User:</b> ${o.user}<br>
      <b>Date:</b> ${o.date}<br>
      <b>Items:</b><br>
      ${o.items.map(i=>i.name+" - ₹"+i.price).join("<br>")}
    `;
    orders.appendChild(div);
  });
}

</script>

</body>
</html>
